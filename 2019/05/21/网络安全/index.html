<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="çŸ¥è¯†åœ¨ä¸–ç•Œçš„æŸä¸ªè§’è½ç­‰ä½ ">
    <meta name="author" content="Chao">
    
    <title>
        
            ç½‘ç»œå®‰å…¨ |
        
        XChao&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/avatar.jpg">
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"xiongcao.github.io","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/avatar.jpg","favicon":"/images/avatar.jpg","avatar":"/images/avatar.jpg","font_size":null,"font_family":null,"hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"é»„è‰²çš„æ£®æ—åˆ†å‡ºä¸¤æ¡è·¯ï¼Œæˆ‘é€‰æ‹©äººè¿¹æ›´å°‘çš„é‚£ä¸€æ¡ï¼Œä»æ­¤å†³å®šæˆ‘ä¸€ç”Ÿçš„é“è·¯ã€‚","font_color":null,"hitokoto":true},"scroll":{"progress_bar":true,"percent":true}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"waline","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":"https://bear-blog-comment-8yis8zzwo-xiongcao.vercel.app","reaction":true,"version":2}},"post":{"author_label":{"enable":true,"auto":false,"custom_label_list":["Trainee","Engineer","Architect","å®ä¹ ç”Ÿ","å·¥ç¨‹å¸ˆ","æ¶æ„å¸ˆ","ç¨‹åºé¼“åŠ±å¸ˆ"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original article title","author":"Original article author","link":"Original article link"}
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/avatar.jpg">
                </a>
            
            <a class="logo-title" href="/">
               XChao&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">ç½‘ç»œå®‰å…¨</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/avatar.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Chao</span>
                            
                                <span class="author-label">å·¥ç¨‹å¸ˆ</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2019-05-21 14:45:00</span>
        <span class="mobile">2019-05-21 14:45</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-07-19 21:23:30</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E7%BD%91%E7%BB%9C/">ç½‘ç»œ</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E5%AE%89%E5%85%A8/">å®‰å…¨</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>3k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>11 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <span id="more"></span> 

<h3 id="1-XSS"><a href="#1-XSS" class="headerlink" title="1. XSS"></a>1. XSS</h3><p><code>XSSï¼ˆCross Site Scriptï¼‰</code>ï¼Œå³&#x3D;&#x3D;è·¨ç«™è„šæœ¬æ”»å‡»&#x3D;&#x3D;ï¼›</p>
<p>XSS æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åœ¨ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„çš„å®¢æˆ·ç«¯ä»£ç ï¼Œé€šè¿‡æ¶æ„è„šæœ¬å¯¹å®¢æˆ·ç«¯ç½‘é¡µè¿›è¡Œç¯¡æ”¹ï¼Œä»è€Œåœ¨ç”¨æˆ·æµè§ˆç½‘é¡µæ—¶ï¼Œå¯¹ç”¨æˆ·æµè§ˆå™¨è¿›è¡Œæ§åˆ¶æˆ–è€…è·å–ç”¨æˆ·éšç§æ•°æ®çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚</p>
<p>æ”»å‡»è€…å¯¹å®¢æˆ·ç«¯ç½‘é¡µæ³¨å…¥çš„æ¶æ„è„šæœ¬ä¸€èˆ¬åŒ…æ‹¬ JavaScriptï¼Œæœ‰æ—¶ä¹Ÿä¼šåŒ…å« HTML å’Œ Flashã€‚æœ‰å¾ˆå¤šç§æ–¹å¼è¿›è¡Œ XSS æ”»å‡»ï¼Œä½†å®ƒä»¬çš„å…±åŒç‚¹ä¸ºï¼šå°†ä¸€äº›éšç§æ•°æ®åƒ cookieã€session å‘é€ç»™æ”»å‡»è€…ï¼Œå°†å—å®³è€…é‡å®šå‘åˆ°ä¸€ä¸ªç”±æ”»å‡»è€…æ§åˆ¶çš„ç½‘ç«™ï¼Œåœ¨å—å®³è€…çš„æœºå™¨ä¸Šè¿›è¡Œä¸€äº›æ¶æ„æ“ä½œã€‚</p>
<p>XSSæ”»å‡»å¯ä»¥åˆ†ä¸º3ç±»ï¼š</p>
<ul>
<li>åå°„å‹ï¼ˆéæŒä¹…å‹ï¼‰</li>
<li>å­˜å‚¨å‹ï¼ˆæŒä¹…å‹ï¼‰</li>
<li>åŸºäºDOMã€‚</li>
</ul>
<h4 id="1-1-åå°„å‹"><a href="#1-1-åå°„å‹" class="headerlink" title="1.1 åå°„å‹"></a>1.1 åå°„å‹</h4><p>åå°„å‹ XSS åªæ˜¯ç®€å•åœ°æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œåå°„â€ ç»™æµè§ˆå™¨ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¾€å¾€éœ€è¦æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæ¶æ„é“¾æ¥ï¼Œæˆ–è€…æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ–è€…è¿›å…¥ä¸€ä¸ªæ¶æ„ç½‘ç«™æ—¶ï¼Œæ³¨å…¥è„šæœ¬è¿›å…¥è¢«æ”»å‡»è€…çš„ç½‘ç«™ã€‚</p>
<p>æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„çš„æ¶æ„è„šæœ¬è¿›è¡Œæ”»å‡»ï¼Œå¯èƒ½æ³¨å…¥æ¶ä½œå‰§è„šæœ¬ï¼Œæˆ–è€…æ³¨å…¥èƒ½è·å–ç”¨æˆ·éšç§æ•°æ®(å¦‚cookie)çš„è„šæœ¬ï¼Œè¿™å–å†³äºæ”»å‡»è€…çš„ç›®çš„ã€‚</p>
<h4 id="1-2-å­˜å‚¨å‹"><a href="#1-2-å­˜å‚¨å‹" class="headerlink" title="1.2 å­˜å‚¨å‹"></a>1.2 å­˜å‚¨å‹</h4><p>å­˜å‚¨å‹ XSS ä¼šæŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œå­˜å‚¨â€ åœ¨æœåŠ¡å™¨ç«¯ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¸Šä¼ å›å¹¶æ‰§è¡Œã€‚è¿™ç§ XSS æ”»å‡»å…·æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§ã€‚</p>
<p>æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåœºæ™¯æ˜¯æ”»å‡»è€…åœ¨ç¤¾åŒºæˆ–è®ºå›ä¸Šå†™ä¸‹ä¸€ç¯‡åŒ…å«æ¶æ„ JavaScript ä»£ç çš„æ–‡ç« æˆ–è¯„è®ºï¼Œæ–‡ç« æˆ–è¯„è®ºå‘è¡¨åï¼Œæ‰€æœ‰è®¿é—®è¯¥æ–‡ç« æˆ–è¯„è®ºçš„ç”¨æˆ·ï¼Œéƒ½ä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè¿™æ®µæ¶æ„çš„ JavaScript ä»£ç ã€‚</p>
<p>å½“ç”¨æˆ·ç‚¹å‡»æäº¤æŒ‰é’®å°†è¾“å…¥ä¿¡æ¯æäº¤åˆ°æœåŠ¡ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯é€šè¿‡ <code>userInput</code> å˜é‡ä¿å­˜äº†è¾“å…¥å†…å®¹ã€‚å½“ç”¨æˆ·é€šè¿‡ <code>http://localhost:8001/$&#123;id&#125;</code> è®¿é—®æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›ä¸ <code>id</code> å¯¹åº”çš„å†…å®¹(æœ¬ç¤ºä¾‹ç®€åŒ–äº†å¤„ç†)ã€‚å¦‚æœç”¨æˆ·è¾“å…¥äº†æ¶æ„è„šæœ¬å†…å®¹ï¼Œåˆ™å…¶ä»–ç”¨æˆ·è®¿é—®è¯¥å†…å®¹æ—¶ï¼Œæ¶æ„è„šæœ¬å°±ä¼šåœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œï¼š</p>
<h4 id="1-3-åŸºäºDOM"><a href="#1-3-åŸºäºDOM" class="headerlink" title="1.3 åŸºäºDOM"></a>1.3 åŸºäºDOM</h4><p>åŸºäº DOM çš„ XSS æ”»å‡»æ˜¯æŒ‡é€šè¿‡æ¶æ„è„šæœ¬ä¿®æ”¹é¡µé¢çš„ DOM ç»“æ„ï¼Œæ˜¯çº¯ç²¹å‘ç”Ÿåœ¨å®¢æˆ·ç«¯çš„æ”»å‡»ã€‚</p>
<p>çœ‹å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>XSS: <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> val;</span></span><br><span class="line"><span class="language-javascript">     </span></span><br><span class="line"><span class="language-javascript">    input.<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        val = e.<span class="property">target</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        div.<span class="property">innerHTML</span> = <span class="string">`&lt;a href=<span class="subst">$&#123;val&#125;</span>&gt;testLink&lt;/a&gt;`</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç‚¹å‡» <code>Submit</code> æŒ‰é’®åï¼Œä¼šåœ¨å½“å‰é¡µé¢æ’å…¥ä¸€ä¸ªé“¾æ¥ï¼Œå…¶åœ°å€ä¸ºç”¨æˆ·çš„è¾“å…¥å†…å®¹ã€‚å¦‚æœç”¨æˆ·åœ¨è¾“å…¥æ—¶æ„é€ äº†å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27; onclick=alert(/xss/)</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·æäº¤ä¹‹åï¼Œé¡µé¢ä»£ç å°±å˜æˆäº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href onlick=&quot;alert(/xss/)&quot;&gt;testLink&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œç”¨æˆ·ç‚¹å‡»ç”Ÿæˆçš„é“¾æ¥ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„è„šæœ¬ï¼š</p>
<h3 id="2-XSS-æ”»å‡»çš„é˜²èŒƒ"><a href="#2-XSS-æ”»å‡»çš„é˜²èŒƒ" class="headerlink" title="2. XSS æ”»å‡»çš„é˜²èŒƒ"></a>2. XSS æ”»å‡»çš„é˜²èŒƒ</h3><p>ç°åœ¨ä¸»æµçš„æµè§ˆå™¨å†…ç½®äº†é˜²èŒƒ XSS çš„æªæ–½ï¼Œä¾‹å¦‚ <a class="link"   target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" >CSP<i class="fas fa-external-link-alt"></i></a>ã€‚ä½†å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œä¹Ÿåº”è¯¥å¯»æ‰¾å¯é çš„è§£å†³æ–¹æ¡ˆæ¥é˜²æ­¢ XSS æ”»å‡»ã€‚</p>
<h4 id="2-1-HttpOnly-é˜²æ­¢åŠ«å–-Cookie"><a href="#2-1-HttpOnly-é˜²æ­¢åŠ«å–-Cookie" class="headerlink" title="2.1 HttpOnly é˜²æ­¢åŠ«å– Cookie"></a>2.1 HttpOnly é˜²æ­¢åŠ«å– Cookie</h4><p>HttpOnly æœ€æ—©ç”±å¾®è½¯æå‡ºï¼Œè‡³ä»Šå·²ç»æˆä¸ºä¸€ä¸ªæ ‡å‡†ã€‚æµè§ˆå™¨å°†ç¦æ­¢é¡µé¢çš„Javascript è®¿é—®å¸¦æœ‰ HttpOnly å±æ€§çš„Cookieã€‚</p>
<p>ä¸Šæ–‡æœ‰è¯´åˆ°ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„è„šæœ¬è·å–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ã€‚é€šå¸¸ Cookie ä¸­éƒ½åŒ…å«äº†ç”¨æˆ·çš„ç™»å½•å‡­è¯ä¿¡æ¯ï¼Œæ”»å‡»è€…åœ¨è·å–åˆ° Cookie ä¹‹åï¼Œåˆ™å¯ä»¥å‘èµ· Cookie åŠ«æŒæ”»å‡»ã€‚æ‰€ä»¥ï¼Œä¸¥æ ¼æ¥è¯´ï¼ŒHttpOnly å¹¶éé˜»æ­¢ XSS æ”»å‡»ï¼Œè€Œæ˜¯èƒ½é˜»æ­¢ XSS æ”»å‡»åçš„ Cookie åŠ«æŒæ”»å‡»ã€‚</p>
<h4 id="2-2-è¾“å…¥æ£€æŸ¥"><a href="#2-2-è¾“å…¥æ£€æŸ¥" class="headerlink" title="2.2 è¾“å…¥æ£€æŸ¥"></a>2.2 è¾“å…¥æ£€æŸ¥</h4><p><strong>ä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„ä»»ä½•è¾“å…¥ã€‚</strong> å¯¹äºç”¨æˆ·çš„ä»»ä½•è¾“å…¥è¦è¿›è¡Œæ£€æŸ¥ã€è¿‡æ»¤å’Œè½¬ä¹‰ã€‚å»ºç«‹å¯ä¿¡ä»»çš„å­—ç¬¦å’Œ HTML æ ‡ç­¾ç™½åå•ï¼Œå¯¹äºä¸åœ¨ç™½åå•ä¹‹åˆ—çš„å­—ç¬¦æˆ–è€…æ ‡ç­¾è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ã€‚</p>
<p>åœ¨ XSS é˜²å¾¡ä¸­ï¼Œè¾“å…¥æ£€æŸ¥ä¸€èˆ¬æ˜¯æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸­æ˜¯å¦åŒ…å« <code>&lt;</code>ï¼Œ<code>&gt;</code> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼Œè¿™ç§æ–¹å¼ä¹Ÿç§°ä¸º XSS Filterã€‚</p>
<p>è€Œåœ¨ä¸€äº›å‰ç«¯æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä»½ <code>decodingMap</code>ï¼Œ ç”¨äºå¯¹ç”¨æˆ·è¾“å…¥æ‰€åŒ…å«çš„ç‰¹æ®Šå­—ç¬¦æˆ–æ ‡ç­¾è¿›è¡Œç¼–ç æˆ–è¿‡æ»¤ï¼Œå¦‚ <code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>script</code>ï¼Œé˜²æ­¢ XSS æ”»å‡»ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> decodingMap = &#123;</span><br><span class="line">  <span class="string">&#x27;&amp;lt;&#x27;</span>: <span class="string">&#x27;&lt;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;&amp;gt;&#x27;</span>: <span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;&amp;quot;&#x27;</span>: <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;&amp;amp;&#x27;</span>: <span class="string">&#x27;&amp;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;&amp;#10;&#x27;</span>: <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-3-è¾“å‡ºæ£€æŸ¥"><a href="#2-3-è¾“å‡ºæ£€æŸ¥" class="headerlink" title="2.3 è¾“å‡ºæ£€æŸ¥"></a>2.3 è¾“å‡ºæ£€æŸ¥</h4><p>ç”¨æˆ·çš„è¾“å…¥ä¼šå­˜åœ¨é—®é¢˜ï¼ŒæœåŠ¡ç«¯çš„è¾“å‡ºä¹Ÿä¼šå­˜åœ¨é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé™¤å¯Œæ–‡æœ¬çš„è¾“å‡ºå¤–ï¼Œåœ¨å˜é‡è¾“å‡ºåˆ° HTML é¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç æˆ–è½¬ä¹‰çš„æ–¹å¼æ¥é˜²å¾¡ XSS æ”»å‡»ã€‚</p>
<h3 id="3-CSRF"><a href="#3-CSRF" class="headerlink" title="3. CSRF"></a>3. CSRF</h3><p><code>CSRFï¼ˆ Cross Site Request Forgeryï¼‰</code>ï¼Œä¸­è¯‘æ˜¯&#x3D;&#x3D;è·¨ç«™è¯·æ±‚ä¼ªé€ &#x3D;&#x3D;ï¼Œæ˜¯ä¸€ç§åŠ«æŒå—ä¿¡ä»»ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€éé¢„æœŸè¯·æ±‚çš„æ”»å‡»æ–¹å¼ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒCSRF æ”»å‡»æ˜¯æ”»å‡»è€…å€ŸåŠ©å—å®³è€…çš„ Cookie éª—å–æœåŠ¡å™¨çš„ä¿¡ä»»ï¼Œå¯ä»¥åœ¨å—å®³è€…æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥å—å®³è€…åä¹‰ä¼ªé€ è¯·æ±‚å‘é€ç»™å—æ”»å‡»æœåŠ¡å™¨ï¼Œä»è€Œåœ¨å¹¶æœªæˆæƒçš„æƒ…å†µä¸‹æ‰§è¡Œåœ¨æƒé™ä¿æŠ¤ä¹‹ä¸‹çš„æ“ä½œã€‚</p>
<p>åœ¨ä¸¾ä¾‹å­ä¹‹å‰ï¼Œå…ˆè¯´è¯´æµè§ˆå™¨çš„ Cookie ç­–ç•¥ã€‚</p>
<h4 id="3-1-æµè§ˆå™¨çš„-Cookie-ç­–ç•¥"><a href="#3-1-æµè§ˆå™¨çš„-Cookie-ç­–ç•¥" class="headerlink" title="3.1 æµè§ˆå™¨çš„ Cookie ç­–ç•¥"></a>3.1 æµè§ˆå™¨çš„ Cookie ç­–ç•¥</h4><p>Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚Cookie ä¸»è¦ç”¨äºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰</li>
<li>ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰</li>
<li>æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰</li>
</ul>
<p>è€Œæµè§ˆå™¨æ‰€æŒæœ‰çš„ Cookie åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>Session Cookie(ä¼šè¯æœŸ Cookie)ï¼šä¼šè¯æœŸ Cookie æ˜¯æœ€ç®€å•çš„Cookieï¼Œå®ƒä¸éœ€è¦æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–è€…æœ‰æ•ˆæœŸï¼ˆMax-Ageï¼‰ï¼Œå®ƒä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</li>
<li>Permanent Cookie(æŒä¹…æ€§ Cookie)ï¼šä¸ä¼šè¯æœŸ Cookie ä¸åŒçš„æ˜¯ï¼ŒæŒä¹…æ€§ Cookie å¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆMax-Ageï¼‰ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Set-Cookie&#x27;</span>, [<span class="string">&#x27;mycookie=222&#x27;</span>, <span class="string">&#x27;test=3333; expires=Sat, 21 Jul 2018 00:00:00 GMT;&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸¤ä¸ª Cookieï¼š<code>mycookie</code> å’Œ <code>test</code>ï¼Œå‰è€…å±äºä¼šè¯æœŸ Cookieï¼Œåè€…åˆ™å±äºæŒä¹…æ€§ Cookieã€‚å½“æˆ‘ä»¬å»æŸ¥çœ‹ Cookie ç›¸å…³çš„å±æ€§æ—¶ï¼Œä¸åŒçš„æµè§ˆå™¨å¯¹ä¼šè¯æœŸ Cookie çš„ <code>Expires</code> å±æ€§å€¼ä¼šä¸ä¸€æ ·ï¼š</p>
<p>Firefoxï¼š</p>
<p>![image-20230414081138509](&#x2F;Users&#x2F;xiongchao&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230414081138509.png)</p>
<p>Chrome:</p>
<p>![image-20230414081204646](&#x2F;Users&#x2F;xiongchao&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230414081204646.png)</p>
<p>æ­¤å¤–ï¼Œæ¯ä¸ª Cookie éƒ½ä¼šæœ‰ä¸ä¹‹å…³è”çš„åŸŸï¼Œè¿™ä¸ªåŸŸçš„èŒƒå›´ä¸€èˆ¬é€šè¿‡ <code>donmain</code> å±æ€§æŒ‡å®šã€‚å¦‚æœ Cookie çš„åŸŸå’Œé¡µé¢çš„åŸŸç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™ä¸ª Cookie ä¸ºç¬¬ä¸€æ–¹ Cookieï¼ˆfirst-party cookieï¼‰ï¼Œå¦‚æœ Cookie çš„åŸŸå’Œé¡µé¢çš„åŸŸä¸åŒï¼Œåˆ™ç§°ä¹‹ä¸ºç¬¬ä¸‰æ–¹ Cookieï¼ˆthird-party cookieï¼‰ã€‚ä¸€ä¸ªé¡µé¢åŒ…å«å›¾ç‰‡æˆ–å­˜æ”¾åœ¨å…¶ä»–åŸŸä¸Šçš„èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼‰æ—¶ï¼Œç¬¬ä¸€æ–¹çš„ Cookie ä¹Ÿåªä¼šå‘é€ç»™è®¾ç½®å®ƒä»¬çš„æœåŠ¡å™¨ã€‚</p>
<h4 id="3-2-é€šè¿‡-Cookie-è¿›è¡Œ-CSRF-æ”»å‡»"><a href="#3-2-é€šè¿‡-Cookie-è¿›è¡Œ-CSRF-æ”»å‡»" class="headerlink" title="3.2 é€šè¿‡ Cookie è¿›è¡Œ CSRF æ”»å‡»"></a>3.2 é€šè¿‡ Cookie è¿›è¡Œ CSRF æ”»å‡»</h4><p>ç”±äº Cookie ä¸­åŒ…å«äº†ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œå½“ç”¨æˆ·è®¿é—®æ”»å‡»è€…å‡†å¤‡çš„æ”»å‡»ç¯å¢ƒæ—¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥å¯¹æœåŠ¡å™¨å‘èµ· CSRF æ”»å‡»ã€‚åœ¨è¿™ä¸ªæ”»å‡»è¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…å€ŸåŠ©å—å®³è€…çš„ Cookie éª—å–æœåŠ¡å™¨çš„ä¿¡ä»»ï¼Œä½†å¹¶ä¸èƒ½æ‹¿åˆ° Cookieï¼Œä¹Ÿçœ‹ä¸åˆ° Cookie çš„å†…å®¹ã€‚è€Œå¯¹äºæœåŠ¡å™¨è¿”å›çš„ç»“æœï¼Œç”±äºæµè§ˆå™¨åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•è¿›è¡Œè§£æã€‚å› æ­¤ï¼Œæ”»å‡»è€…æ— æ³•ä»è¿”å›çš„ç»“æœä¸­å¾—åˆ°ä»»ä½•ä¸œè¥¿ï¼Œä»–æ‰€èƒ½åšçš„å°±æ˜¯ç»™æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä»¥æ‰§è¡Œè¯·æ±‚ä¸­æ‰€æè¿°çš„å‘½ä»¤ï¼Œåœ¨æœåŠ¡å™¨ç«¯ç›´æ¥æ”¹å˜æ•°æ®çš„å€¼ï¼Œè€Œéçªƒå–æœåŠ¡å™¨ä¸­çš„æ•°æ®ã€‚</p>
<p>ä½†è‹¥ CSRF æ”»å‡»çš„ç›®æ ‡å¹¶ä¸éœ€è¦ä½¿ç”¨ Cookieï¼Œåˆ™ä¹Ÿä¸å¿…é¡¾è™‘æµè§ˆå™¨çš„ Cookie ç­–ç•¥äº†ã€‚</p>
<h3 id="4-CSRF-æ”»å‡»çš„é˜²èŒƒ"><a href="#4-CSRF-æ”»å‡»çš„é˜²èŒƒ" class="headerlink" title="4. CSRF æ”»å‡»çš„é˜²èŒƒ"></a>4. CSRF æ”»å‡»çš„é˜²èŒƒ</h3><p>å½“å‰ï¼Œå¯¹ CSRF æ”»å‡»çš„é˜²èŒƒæªæ–½ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ã€‚</p>
<ul>
<li>éªŒè¯ç </li>
<li>referer check</li>
<li>æ·»åŠ  token éªŒè¯</li>
</ul>
<h4 id="4-1-éªŒè¯ç "><a href="#4-1-éªŒè¯ç " class="headerlink" title="4.1 éªŒè¯ç "></a>4.1 éªŒè¯ç </h4><p>éªŒè¯ç è¢«è®¤ä¸ºæ˜¯å¯¹æŠ— CSRF æ”»å‡»æœ€ç®€æ´è€Œæœ‰æ•ˆçš„é˜²å¾¡æ–¹æ³•ã€‚</p>
<p>ä»ä¸Šè¿°ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼ŒCSRF æ”»å‡»å¾€å¾€æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ„é€ äº†ç½‘ç»œè¯·æ±‚ã€‚è€ŒéªŒè¯ç ä¼šå¼ºåˆ¶ç”¨æˆ·å¿…é¡»ä¸åº”ç”¨è¿›è¡Œäº¤äº’ï¼Œæ‰èƒ½å®Œæˆæœ€ç»ˆè¯·æ±‚ã€‚å› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼ŒéªŒè¯ç èƒ½å¤Ÿå¾ˆå¥½åœ°éåˆ¶ CSRF æ”»å‡»ã€‚</p>
<p>ä½†éªŒè¯ç å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå› ä¸ºå‡ºäºç”¨æˆ·è€ƒè™‘ï¼Œä¸èƒ½ç»™ç½‘ç«™æ‰€æœ‰çš„æ“ä½œéƒ½åŠ ä¸ŠéªŒè¯ç ã€‚å› æ­¤ï¼ŒéªŒè¯ç åªèƒ½ä½œä¸ºé˜²å¾¡ CSRF çš„ä¸€ç§è¾…åŠ©æ‰‹æ®µï¼Œè€Œä¸èƒ½ä½œä¸ºæœ€ä¸»è¦çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="4-2-Referer-Check"><a href="#4-2-Referer-Check" class="headerlink" title="4.2 Referer Check"></a>4.2 Referer Check</h4><p>æ ¹æ® HTTP åè®®ï¼Œåœ¨ HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚é€šè¿‡ Referer Checkï¼Œå¯ä»¥æ£€æŸ¥è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„â€æºâ€ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœç”¨æˆ·è¦åˆ é™¤è‡ªå·±çš„å¸–å­ï¼Œé‚£ä¹ˆå…ˆè¦ç™»å½• <code>www.c.com</code>ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„é¡µé¢ï¼Œå‘èµ·åˆ é™¤å¸–å­çš„è¯·æ±‚ã€‚æ­¤æ—¶ï¼ŒReferer çš„å€¼æ˜¯ <code>http://www.c.com</code>ï¼›å½“è¯·æ±‚æ˜¯ä» <code>www.a.com</code> å‘èµ·æ—¶ï¼ŒReferer çš„å€¼æ˜¯ <code>http://www.a.com</code> äº†ã€‚å› æ­¤ï¼Œè¦é˜²å¾¡ CSRF æ”»å‡»ï¼Œåªéœ€è¦å¯¹äºæ¯ä¸€ä¸ªåˆ å¸–è¯·æ±‚éªŒè¯å…¶ Referer å€¼ï¼Œå¦‚æœæ˜¯ä»¥ <code>www.c.com</code> å¼€å¤´çš„åŸŸåï¼Œåˆ™è¯´æ˜è¯¥è¯·æ±‚æ˜¯æ¥è‡ªç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œæ˜¯åˆæ³•çš„ã€‚å¦‚æœ Referer æ˜¯å…¶ä»–ç½‘ç«™çš„è¯ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ CSRF æ”»å‡»ï¼Œå¯ä»¥æ‹’ç»è¯¥è¯·æ±‚ã€‚</p>
<p>Referer Check ä¸ä»…èƒ½é˜²èŒƒ CSRF æ”»å‡»ï¼Œå¦ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯ â€œé˜²æ­¢å›¾ç‰‡ç›—é“¾â€ã€‚</p>
<h4 id="4-3-æ·»åŠ -token-éªŒè¯"><a href="#4-3-æ·»åŠ -token-éªŒè¯" class="headerlink" title="4.3 æ·»åŠ  token éªŒè¯"></a>4.3 æ·»åŠ  token éªŒè¯</h4><p>CSRF æ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæ”»å‡»è€…å¯ä»¥å®Œå…¨ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­æ‰€æœ‰çš„ç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½æ˜¯å­˜åœ¨äº Cookie ä¸­ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“è¿™äº›éªŒè¯ä¿¡æ¯çš„æƒ…å†µä¸‹ç›´æ¥åˆ©ç”¨ç”¨æˆ·è‡ªå·±çš„ Cookie æ¥é€šè¿‡å®‰å…¨éªŒè¯ã€‚è¦æŠµå¾¡ CSRFï¼Œå…³é”®åœ¨äºåœ¨è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯ä¸å­˜åœ¨äº Cookie ä¹‹ä¸­ã€‚å¯ä»¥åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªæ‹¦æˆªå™¨æ¥éªŒè¯è¿™ä¸ª tokenï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºå¯èƒ½æ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>XSSæ”»å‡»å¯ä»¥åˆ†ä¸º3ç±»ï¼š</p>
<ul>
<li><p>åå°„å‹ï¼ˆéæŒä¹…å‹ï¼‰ï¼šè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥ï¼›</p>
</li>
<li><p>å­˜å‚¨å‹ï¼ˆæŒä¹…å‹ï¼‰ï¼šæ”»å‡»è€…åœ¨è®ºå›ä¸Šå†™ä¸‹ä¸€ç¯‡åŒ…å«æ¶æ„ è„šæœ¬çš„æ–‡ç« æˆ–è¯„è®ºï¼Œç”¨æˆ·è®¿é—®åï¼Œä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè¿™æ®µæ¶æ„çš„è„šæœ¬ã€‚</p>
</li>
<li><p>åŸºäºDOMï¼šé€šè¿‡æ¶æ„è„šæœ¬ä¿®æ”¹é¡µé¢çš„ DOM ç»“æ„</p>
</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ XSS æ”»å‡»å’Œ CSRF æ”»å‡»çš„å¸¸è§é˜²å¾¡æªæ–½ï¼š</p>
<ol>
<li><p>é˜²å¾¡ XSS æ”»å‡»</p>
<ul>
<li>HttpOnly é˜²æ­¢åŠ«å– Cookieã€‚ï¼ˆæµè§ˆå™¨å°†ç¦æ­¢é¡µé¢çš„Javascript è®¿é—®å¸¦æœ‰ HttpOnly å±æ€§çš„Cookieã€‚ï¼‰</li>
<li>ç”¨æˆ·çš„è¾“å…¥æ£€æŸ¥ã€‚ï¼ˆå¯¹äºç”¨æˆ·çš„ä»»ä½•è¾“å…¥è¦è¿›è¡Œæ£€æŸ¥ã€è¿‡æ»¤å’Œè½¬ä¹‰ï¼Œå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼‰</li>
<li>æœåŠ¡ç«¯çš„è¾“å‡ºæ£€æŸ¥</li>
</ul>
</li>
<li><p>é˜²å¾¡ CSRF æ”»å‡»</p>
<ul>
<li>éªŒè¯ç </li>
<li>Referer Check</li>
<li>Token éªŒè¯</li>
</ul>
</li>
</ol>
<p>ğŸ‘‰ğŸ‘‰ <a class="link"   target="_blank" rel="noopener" href="https://github.com/dwqs/blog/issues/68" >æµ…è¯´ XSS å’Œ CSRF<i class="fas fa-external-link-alt"></i></a></p>

            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">Post title</span>: <span class="content">ç½‘ç»œå®‰å…¨</span>
        </li>
        <li class="post-author">
            <span class="type">Post author</span>: <span class="content">Chao</span>
        </li>
        <li class="post-time">
            <span class="type">Create time</span>: <span class="content">2019-05-21 14:45:00</span>
        </li>
        <li class="post-link">
            <span class="type">Post link</span>: <span class="content">2019/05/21/ç½‘ç»œå®‰å…¨/</span>
        </li>
        <li class="post-license">
            <span class="type">Copyright notice</span>: <span class="content">All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="Copy copyright info" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/%E7%BD%91%E7%BB%9C/">#ç½‘ç»œ</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E5%AE%89%E5%85%A8/">#å®‰å…¨</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2019/06/26/%E7%BD%91%E9%A1%B5%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">ç½‘é¡µæ¸²æŸ“åŸç†</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2019/05/09/%E5%9B%BE%E5%B1%82%E7%9A%84%E9%87%8D%E7%BB%98%E4%B8%8E%E5%9B%9E%E6%B5%81/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">å›¾å±‚çš„é‡ç»˜ä¸å›æµ</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                <div class="comment-container">
                    
<div class="comments-container">
    <div id="comments-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments"></i>&nbsp;Comments
    </div>
    
        
            

    <div class="waline-comment-container">
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline-meta.css"/>
        <script data-pjax src="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline.js"></script>
        <div id="waline-comment"></div>
        <script data-pjax>
          function loadWaline() {
            Waline.init({
              el: '#waline-comment',
              serverURL: 'https://bear-blog-comment-8yis8zzwo-xiongcao.vercel.app',
              lang: 'en' || 'zh-CN',
              comment: '.post-comments-count',
              reaction: 'true' === 'true'
            })
          }

          if ('true' === 'true') {
            setTimeout(() => {
              loadWaline()
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadWaline)
          }
        </script>
    </div>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-XSS"><span class="nav-number">1.</span> <span class="nav-text">1. XSS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 åå°„å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 å­˜å‚¨å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-%E5%9F%BA%E4%BA%8EDOM"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 åŸºäºDOM</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-XSS-%E6%94%BB%E5%87%BB%E7%9A%84%E9%98%B2%E8%8C%83"><span class="nav-number">2.</span> <span class="nav-text">2. XSS æ”»å‡»çš„é˜²èŒƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-HttpOnly-%E9%98%B2%E6%AD%A2%E5%8A%AB%E5%8F%96-Cookie"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 HttpOnly é˜²æ­¢åŠ«å– Cookie</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E8%BE%93%E5%85%A5%E6%A3%80%E6%9F%A5"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 è¾“å…¥æ£€æŸ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E8%BE%93%E5%87%BA%E6%A3%80%E6%9F%A5"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 è¾“å‡ºæ£€æŸ¥</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CSRF"><span class="nav-number">3.</span> <span class="nav-text">3. CSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84-Cookie-%E7%AD%96%E7%95%A5"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 æµè§ˆå™¨çš„ Cookie ç­–ç•¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E9%80%9A%E8%BF%87-Cookie-%E8%BF%9B%E8%A1%8C-CSRF-%E6%94%BB%E5%87%BB"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 é€šè¿‡ Cookie è¿›è¡Œ CSRF æ”»å‡»</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-CSRF-%E6%94%BB%E5%87%BB%E7%9A%84%E9%98%B2%E8%8C%83"><span class="nav-number">4.</span> <span class="nav-text">4. CSRF æ”»å‡»çš„é˜²èŒƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 éªŒè¯ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-Referer-Check"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 Referer Check</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-%E6%B7%BB%E5%8A%A0-token-%E9%AA%8C%E8%AF%81"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 æ·»åŠ  token éªŒè¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2017</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Chao</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
            <div class="icp-info info-item">
                <a target="_blank" rel="nofollow"
                   href="https://beian.miit.gov.cn"
                >
                    é„‚ICPè¯000000001å·
                </a>
            </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        $tools-item-width = 2.2rem
$tools-item-font-size = 1.1rem
$tools-item-border-radius = 0.1rem


.side-tools-container {
  position relative

  .tools-item {
    width $tools-item-width
    height $tools-item-width
    margin-bottom 0.2rem
    color var(--text-color-3)
    font-size $tools-item-font-size
    background var(--background-color-1)
    border-right none
    border-radius $tools-item-border-radius
    box-shadow 0.1rem 0.1rem 0.2rem var(--shadow-color)
    cursor pointer

    i {
      color var(--text-color-3)
    }

    &:hover {
      color var(--background-color-1)
      background var(--primary-color)
      box-shadow 0.2rem 0.2rem 0.4rem var(--shadow-color)

      i {
        color var(--background-color-1)
      }
    }

    +keep-tablet() {
      width $tools-item-width * 0.9
      height $tools-item-width * 0.9
      margin-bottom 0.2rem
      font-size $tools-item-font-size * 0.9
    }

    &.rss {

      a {
        width 100%
        height 100%
        border-radius $tools-item-border-radius

        &:hover {
          color var(--background-color-1)
          background var(--primary-color)
          box-shadow 0.2rem 0.2rem 0.4rem var(--shadow-color)
        }
      }
    }
  }


  .side-tools-list {
    transform translateX(100%)
    opacity 0
    transition-t("transform, opacity", "0, 0", "0.2, 0.2", "linear, linear")

    &.show {
      transform translateX(0)
      opacity 1
    }
  }


  .exposed-tools-list {

    if (hexo-config('style.scroll.percent') == true) {
      .tool-scroll-to-top {
        display none

        &.show {
          display flex
        }

        &:hover {

          .percent {
            display none
          }

          .arrow-up {
            display flex
          }
        }

        .arrow-up {
          display none
        }

        .percent {
          display flex
          font-size 1rem
        }
      }
    }
  }
}

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        $icon-size = 1.2rem
$search-header-height = 3rem

.search-pop-overlay {
  position fixed
  top 0
  left 0
  z-index $z-index-8
  display flex
  width 100%
  height 100%
  background rgba(0, 0, 0, 0)
  visibility hidden
  transition-t("visibility, background", "0, 0", "0.3, 0.3", "ease, ease")

  &.active {
    background rgba(0, 0, 0, 0.35)
    visibility visible

    .search-popup {
      transform scale(1)
    }
  }


  .search-popup {
    z-index $z-index-6
    width 70%
    height 80%
    margin auto
    background var(--background-color-1)
    border-radius 0.4rem
    transform scale(0)
    transition-t("transform", "0", "0.3", "ease")

    +keep-tablet() {
      width 80%
    }

    +keep-mobile() {
      width 90%
    }

    .search-header {
      display flex
      align-items center
      height $search-header-height
      padding 0 1rem
      background var(--text-color-6)
      border-top-left-radius 0.2rem
      border-top-right-radius 0.2rem

      .search-input-field-pre {
        margin-right 0.2rem
        color var(--text-color-3)
        font-size 1.3rem
        cursor pointer
      }

      .search-input-container {
        flex-grow 1
        padding 0.2rem

        .search-input {
          width 100%
          color var(--text-color-3)
          font-size 1.2rem
          background transparent
          border 0
          outline 0

          &::-webkit-search-cancel-button {
            display none
          }

          &::-webkit-input-placeholder {
            color var(--text-color-4)
            font-size 1rem
          }
        }
      }


      .close-popup-btn {
        color var(--text-color-3)
        font-size $icon-size
        cursor pointer

        &:hover {
          color var(--text-color-1)
        }
      }
    }


    #search-result {
      position relative
      display flex
      box-sizing border-box
      height 'calc(100% - %s)' % $search-header-height
      padding 0.3rem 1.5rem
      overflow auto

      .search-result-list {
        width 100%
        height 100%
        font-size 1rem

        li {
          box-sizing border-box
          margin 0.8rem 0
          padding 0.8rem 0
          border-bottom 0.1rem dashed var(--border-color)

          &:last-child {
            border-bottom none
          }


          .search-result-title {
            position relative
            display flex
            align-items center
            margin-bottom 0.8rem
            padding-left 1rem
            font-weight bold

            &::after {
              position absolute
              top 50%
              left 0
              width 0.4rem
              height 0.4rem
              background var(--text-color-3)
              border-radius 50%
              transform translateY(-50%)
              content ''
            }
          }


          .search-result {
            margin 0
            padding-left 1rem
            line-height 2rem
            word-wrap break-word
          }

          a {
            &:hover {
              color var(--text-color-3)
            }
          }

          .search-keyword {
            color var(--primary-color)
            font-weight bold
            border-bottom 0.1rem dashed var(--primary-color)
          }
        }
      }


      #no-result {
        margin auto
        color var(--text-color-4)
      }
    }
  }
}


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-block.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/post-helper.js"></script>

        
            
<script src="/js/libs/anime.min.js"></script>

        
        
            
<script src="/js/toc.js"></script>

        
    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
